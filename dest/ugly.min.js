angular.module("ChatApp",["ngRoute"]),angular.module("ChatApp").config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/Login.html",controller:"LoginCtrl"}).when("/Home/Lobby",{templateUrl:"views/Home.html",controller:"HomeCtrl"}).when("/Home/:roomName",{templateUrl:"views/ChatRoom.html",controller:"HomeCtrl"}).otherwise({redirectTo:"/"})}]),angular.module("ChatApp").factory("Globals",[function(){var a,b="",c=0;return{setUserName:function(a){b=a},getUserName:function(){return b},getSocket:function(){return void 0===a&&(a=io.connect("http://localhost:8080")),a},getNumberOfRooms:function(){return c},setNumberOfRooms:function(a){c=a}}}]),angular.module("ChatApp").controller("LoginCtrl",["$scope","$location","Globals",function(a,b,c){a.userName=c.getUserName(),a.errorMessage="";var d=c.getSocket();a.connect=function(){d.emit("adduser",a.userName,function(d){d?""===a.userName?a.errorMessage="Please select a user name:":(c.setUserName(a.userName),b.path("/Home/Lobby")):a.errorMessage=""===a.userName?"Please select a user name":"That user name is already taken!",a.$apply()})}}]),angular.module("ChatApp").controller("HomeCtrl",["$scope","$location","Globals","$routeParams",function(a,b,c,d){function e(){f.emit("rooms")}a.chatRooms=[],a.messageList=[],a.userList=[],a.chatRoomName="",a.userName=c.getUserName(),a.theMessage="",a.privateMessages=[],a.currentRoom=d.roomName;var f=c.getSocket();e(),f.on("roomlist",function(b){a.chatRooms=b,delete b.lobby,a.$apply()}),a.createNewChatRoom=function(){console.log("Creating a new chatroom: "+a.chatRoomName),c.setNumberOfRooms(c.getNumberOfRooms()+1),a.joinRoom(c.getNumberOfRooms()-1)},a.joinRoom=function(c){f.emit("joinroom",{room:c},function(d,e){d===!0?(a.currentRoom=c,b.path("Home/"+c),a.$apply()):alert("Joining room failed: "+e)})},a.leaveRoom=function(){f.emit("partroom",a.currentRoom),b.path("Home/Lobby"),a.currentRoom="Lobby",a.$apply()},f.on("updateusers",function(b,c){a.$apply(),console.log("updateusers"),a.currentRoom==b&&(a.userList=c,console.log(c)),a.$apply()}),f.on("servermessage",function(b,c,d){a.$apply(),console.log("ServerMessage"),"join"===b&&a.currentRoom===c&&(a.userList[d]=d),a.$apply()}),f.on("updatechat",function(b,c){console.log("updatechat"),a.$apply(),a.currentRoom==b&&(a.messageList=c),a.$apply()}),f.on("recv_privatemsg",function(b,c){console.log("Private message from "+b+": "+c),a.privateMessages.push({from:b,message:c}),a.$apply()}),f.on("kicked",function(b,d,e){console.log(d+" kicked from "+b+" by "+e),console.log(c.getUserName()),a.userName===d&&a.currentRoom===b&&(alert("You have been kicked from the room"),a.leaveRoom())}),f.on("banned",function(b,d,e){console.log(d+" banned from "+b+" by "+e),console.log(c.getUserName()),a.userName===d&&a.currentRoom===b&&(alert("You have been banned from the room"),a.leaveRoom())}),a.sendMessage=function(){var b=a.theMessage,c=b.indexOf(" ");if("@"===b[0]){console.log("Personal message");var d=b.slice(1,c),e=b.slice(c+1);console.log(d),console.log(e),f.emit("privatemsg",{nick:d,message:e},function(a){console.log(a?"Message successfully sent":"Message not sent")})}else if("/"===b[0]){console.log("Command");var g=b.slice(1,c),h=b.slice(c+1);console.log(g),console.log(h),"ban"===g?f.emit("ban",{user:h,room:a.currentRoom},function(a){console.log(a?"User successfully banned":"Baning user failed")}):"kick"===g&&f.emit("kick",{user:h,room:a.currentRoom},function(a){console.log(a?"User successfully kicked":"Kicking user failed")})}else f.emit("sendmsg",{roomName:a.currentRoom,msg:a.theMessage});a.theMessage="",a.$apply()}}]);