angular.module("ChatApp",["ngRoute"]),angular.module("ChatApp").config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/Login.html",controller:"LoginCtrl"}).when("/Home/Lobby",{templateUrl:"views/Home.html",controller:"HomeCtrl"}).when("/Home/:roomName",{templateUrl:"views/ChatRoom.html",controller:"HomeCtrl"}).otherwise({redirectTo:"/"})}]),angular.module("ChatApp").factory("Globals",[function(){var a,b,c="",d=0;return{setUserName:function(a){c=a},getUserName:function(){return c},getSocket:function(){return void 0===a&&(a=io.connect("http://localhost:8080")),a},getNumberOfRooms:function(){return d},setNumberOfRooms:function(a){d=a},getCurrentRoom:function(){return b},setCurrentRoom:function(a){b=a}}}]),angular.module("ChatApp").controller("LoginCtrl",["$scope","$location","Globals",function(a,b,c){a.userName=c.getUserName(),a.errorMessage="";var d=c.getSocket();a.connect=function(){d.emit("adduser",a.userName,function(d){d?""===a.userName?a.errorMessage="Please select a user name:":(c.setUserName(a.userName),b.path("/Home/Lobby")):a.errorMessage=""===a.userName?"Please select a user name":"That user name is already taken!",a.$apply()})}}]),angular.module("ChatApp").controller("HomeCtrl",["$scope","$location","Globals","$routeParams",function(a,b,c,d){function e(){f.emit("rooms")}a.chatRooms=[],a.messageList=[],a.userList=[],a.roomName=d.roomName,a.chatRoomName="",a.userName=c.getUserName(),a.theMessage="";var f=c.getSocket();e(),f.on("roomlist",function(b){a.chatRooms=b,a.$apply()}),a.createNewChatRoom=function(){console.log("Creating a new chatroom: "+a.chatRoomName),c.setNumberOfRooms(c.getNumberOfRooms()+1),a.joinRoom(c.getNumberOfRooms()-1)},a.joinRoom=function(d){f.emit("joinroom",{room:d},function(e){e===!0?(c.setCurrentRoom(d),b.path("Home/"+d),a.$apply()):alert("Failure")})},f.on("updateusers",function(b,d){c.getCurrentRoom()==b&&(a.userList=d),console.log("updateusers"),a.$apply()}),f.on("servermessage",function(a){}),f.on("updatechat",function(b,d){console.log("updatechat: roomNumber: "+b+" getCurrentRoom: "+c.getCurrentRoom()),console.log(""),c.getCurrentRoom()==b&&(a.messageList=d,console.log("messageList updated")),a.$apply()}),a.sendMessage=function(){console.log("currentRoom: "+c.getCurrentRoom()),console.log("roomName: "+a.roomName),console.log("message: "+a.theMessage),f.emit("sendmsg",{roomName:c.getCurrentRoom(),msg:a.theMessage}),a.theMessage=""}}]);